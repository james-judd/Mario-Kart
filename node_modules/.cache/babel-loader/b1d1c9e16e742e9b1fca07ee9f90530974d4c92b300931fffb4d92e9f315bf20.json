{"ast":null,"code":"var _jsxFileName = \"/Users/jamesjudd/gluon/src/Body.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport { Podium } from \"./Podium\";\nimport { Race } from \"./Race\";\nimport { Logo } from \"./Logo\";\nimport { characters } from \"./assets/mario_kart/characters/charactersStates\";\nimport { Countdown } from \"./Countdown\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Body = props => {\n  _s();\n  const getWindowSize = () => {\n    const {\n      innerWidth\n    } = window;\n    return {\n      innerWidth\n    };\n  };\n  let raceInProgress = false;\n  const [ordersArr, setOrdersArr] = useState([]);\n  const [raceProgress, setRaceProgress] = useState(0);\n  const [countdown, setCountdown] = useState(3);\n  const [windowSize, setWindowSize] = useState(getWindowSize());\n  useEffect(() => {\n    function handleWindowResize() {\n      setWindowSize(getWindowSize());\n    }\n    window.addEventListener(\"resize\", handleWindowResize);\n    return () => {\n      window.removeEventListener(\"resize\", handleWindowResize);\n    };\n  }, []);\n  const handleMessage = event => {\n    // console.log(ordersArr);\n    const parsed = JSON.parse(event.data);\n    const {\n      innerWidth\n    } = getWindowSize();\n    if (parsed.message && parsed.message.total_items_price) {\n      const totalGbpPrice = parsed.message.total_items_price.gbp_value;\n      const brand = parsed.message.property.channel;\n      const siteID = parsed.message.property.site_id;\n      // console.log(\n      //   \"filtered items\",\n      //   ordersArr.filter((e) => e.brandName === brand)\n      // );\n\n      // console.log(\"adding\");\n      setOrdersArr(prev => {\n        if (prev.length < 6 && prev.filter(e => e.brandName === brand).length === 0) {\n          const order = {\n            brandName: brand,\n            totalValue: 0,\n            characterName: characters[prev.length],\n            siteID: siteID,\n            logo: \"\"\n          };\n          // console.log(order)\n          return [...prev, order];\n        } else if (prev.length === 6 && prev.every(e => e.totalValue < innerWidth * 7)) {\n          const matchingOrder = prev.find(e => e.brandName === brand);\n          if (matchingOrder !== undefined) {\n            matchingOrder.totalValue = matchingOrder.totalValue + totalGbpPrice / 7;\n            return [...prev];\n          }\n        }\n        return [...prev];\n      });\n    }\n  };\n  useEffect(() => {\n    const socket = new WebSocket(\"wss://stable-incubator.thehut.net/cashboard-websocket-orders/?filter=orders\");\n    socket.addEventListener(\"message\", handleMessage);\n    socket.onerror = () => {\n      console.log(\"Error with websocket, reloading page\");\n      window.location.reload(true);\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    if (countdown > -1 && ordersArr.length === 6) {\n      setTimeout(() => setCountdown(countdown - 1), 1000);\n    }\n  });\n  if (countdown > -1 && ordersArr.length === 6) {\n    if (countdown === 0) {\n      return /*#__PURE__*/_jsxDEV(Countdown, {\n        text: \"Go!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 14\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(Countdown, {\n      text: countdown\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 12\n    }, this);\n  }\n  const wsClose = socket => {\n    socket.close();\n  };\n  if (ordersArr.length === 6) {\n    Logo(ordersArr);\n  } else {\n    console.log(\"Brands Allocated: \", ordersArr.length);\n    return /*#__PURE__*/_jsxDEV(Countdown, {\n      text: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 12\n    }, this);\n  }\n\n  // console.log(ordersArr);\n  if (ordersArr.length === 6) {\n    raceInProgress = true;\n    const finalPositions = ordersArr.sort(function (a, b) {\n      return b.totalValue - a.totalValue;\n    });\n    if (raceInProgress) {\n      setInterval(() => {\n        setRaceProgress(raceProgress => raceProgress + 0.01);\n      }, 10);\n    }\n    console.log(finalPositions[\"0\"]);\n    const firstPlace = finalPositions[\"0\"];\n    const secondPlace = finalPositions[\"1\"];\n    const thirdPlace = finalPositions[\"2\"];\n    if ((firstPlace.totalValue + raceProgress) / 7 > windowSize.innerWidth) {\n      first = prev.firstPlace;\n      second = prev.secondPlace;\n      third = prev.thirdPlace;\n      if (first < 3000000) {\n        setOrdersArr(prev => {\n          first.totalValue = first.totalValue + 3000000;\n          second.totalValue = second.totalValue + 2000000;\n          third.totalValue = third.totalValue + 1000000;\n          return [...prev];\n        });\n      }\n      return /*#__PURE__*/_jsxDEV(Podium, {\n        changePage: props.changePage,\n        firstPlaceValue: firstPlace.totalValue,\n        secondPlaceValue: secondPlace.totalValue,\n        thirdPlaceValue: thirdPlace.totalValue,\n        brand1: firstPlace.brandName,\n        brand2: secondPlace.brandName,\n        brand3: thirdPlace.brandName,\n        firstPlaceChar: firstPlace.characterName,\n        secondPlaceChar: secondPlace.characterName,\n        thirdPlaceChar: thirdPlace.characterName,\n        logo1: firstPlace.logo,\n        logo2: secondPlace.logo,\n        logo3: thirdPlace.logo,\n        socketClose: wsClose\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(Race, {\n        raceProgress: raceProgress,\n        array: ordersArr\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 14\n      }, this);\n    }\n  }\n};\n_s(Body, \"g98EtCqaR5dKq4LDUVVb/zCVdIU=\");\n_c = Body;\nvar _c;\n$RefreshReg$(_c, \"Body\");","map":{"version":3,"names":["useEffect","useState","Podium","Race","Logo","characters","Countdown","Body","props","getWindowSize","innerWidth","window","raceInProgress","ordersArr","setOrdersArr","raceProgress","setRaceProgress","countdown","setCountdown","windowSize","setWindowSize","handleWindowResize","addEventListener","removeEventListener","handleMessage","event","parsed","JSON","parse","data","message","total_items_price","totalGbpPrice","gbp_value","brand","property","channel","siteID","site_id","prev","length","filter","e","brandName","order","totalValue","characterName","logo","every","matchingOrder","find","undefined","socket","WebSocket","onerror","console","log","location","reload","setTimeout","wsClose","close","finalPositions","sort","a","b","setInterval","firstPlace","secondPlace","thirdPlace","first","second","third","changePage"],"sources":["/Users/jamesjudd/gluon/src/Body.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport { Podium } from \"./Podium\";\nimport { Race } from \"./Race\";\nimport { Logo } from \"./Logo\";\nimport { characters } from \"./assets/mario_kart/characters/charactersStates\";\nimport { Countdown } from \"./Countdown\";\n\nexport const Body = (props) => {\n  const getWindowSize = () => {\n    const { innerWidth } = window;\n    return { innerWidth };\n  };\n  let raceInProgress = false;\n  const [ordersArr, setOrdersArr] = useState([]);\n  const [raceProgress, setRaceProgress] = useState(0);\n  const [countdown, setCountdown] = useState(3);\n  const [windowSize, setWindowSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    function handleWindowResize() {\n      setWindowSize(getWindowSize());\n    }\n\n    window.addEventListener(\"resize\", handleWindowResize);\n\n    return () => {\n      window.removeEventListener(\"resize\", handleWindowResize);\n    };\n  }, []);\n\n  const handleMessage = (event) => {\n    // console.log(ordersArr);\n    const parsed = JSON.parse(event.data);\n    const { innerWidth } = getWindowSize();\n\n    if (parsed.message && parsed.message.total_items_price) {\n      const totalGbpPrice = parsed.message.total_items_price.gbp_value;\n      const brand = parsed.message.property.channel;\n      const siteID = parsed.message.property.site_id;\n      // console.log(\n      //   \"filtered items\",\n      //   ordersArr.filter((e) => e.brandName === brand)\n      // );\n\n      // console.log(\"adding\");\n      setOrdersArr((prev) => {\n        if (\n          prev.length < 6 &&\n          prev.filter((e) => e.brandName === brand).length === 0\n        ) {\n          const order = {\n            brandName: brand,\n            totalValue: 0,\n            characterName: characters[prev.length],\n            siteID: siteID,\n            logo: \"\",\n          };\n          // console.log(order)\n          return [...prev, order];\n        } else if (\n          prev.length === 6 &&\n          prev.every((e) => e.totalValue < innerWidth * 7)\n        ) {\n          const matchingOrder = prev.find((e) => e.brandName === brand);\n          if (matchingOrder !== undefined) {\n            matchingOrder.totalValue =\n              matchingOrder.totalValue + totalGbpPrice / 7;\n            return [...prev];\n          }\n        }\n        return [...prev];\n      });\n    }\n  };\n  useEffect(() => {\n    const socket = new WebSocket(\n      \"wss://stable-incubator.thehut.net/cashboard-websocket-orders/?filter=orders\"\n    );\n    socket.addEventListener(\"message\", handleMessage);\n\n    socket.onerror = () => {\n      console.log(\"Error with websocket, reloading page\");\n      window.location.reload(true);\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (countdown > -1 && ordersArr.length === 6) {\n      setTimeout(() => setCountdown(countdown - 1), 1000);\n    }\n  });\n\n  if (countdown > -1 && ordersArr.length === 6) {\n    if (countdown === 0) {\n      return <Countdown text=\"Go!\" />;\n    }\n    return <Countdown text={countdown} />;\n  }\n\n  const wsClose = (socket) => {\n    socket.close();\n  };\n\n  if (ordersArr.length === 6) {\n    Logo(ordersArr);\n  } else {\n    console.log(\"Brands Allocated: \", ordersArr.length);\n    return <Countdown text=\"Loading...\" />;\n  }\n\n  // console.log(ordersArr);\n  if (ordersArr.length === 6) {\n    raceInProgress = true;\n    const finalPositions = ordersArr.sort(function (a, b) {\n      return b.totalValue - a.totalValue;\n    });\n\n    if (raceInProgress) {\n      setInterval(() => {\n        setRaceProgress((raceProgress) => raceProgress + 0.01);\n      }, 10);\n    }\n\n    console.log(finalPositions[\"0\"]);\n\n    const firstPlace = finalPositions[\"0\"];\n    const secondPlace = finalPositions[\"1\"];\n    const thirdPlace = finalPositions[\"2\"];\n\n    if ((firstPlace.totalValue + raceProgress) / 7 > windowSize.innerWidth) {\n      first = prev.firstPlace;\n      second = prev.secondPlace;\n      third = prev.thirdPlace;\n      if (first < 3000000){\n        setOrdersArr((prev) => {\n          first.totalValue = first.totalValue + 3000000;\n          second.totalValue = second.totalValue + 2000000;\n          third.totalValue = third.totalValue + 1000000;\n          return [...prev]\n        })\n      }\n      return (\n        <Podium\n          changePage={props.changePage}\n          firstPlaceValue={firstPlace.totalValue}\n          secondPlaceValue={secondPlace.totalValue}\n          thirdPlaceValue={thirdPlace.totalValue}\n          brand1={firstPlace.brandName}\n          brand2={secondPlace.brandName}\n          brand3={thirdPlace.brandName}\n          firstPlaceChar={firstPlace.characterName}\n          secondPlaceChar={secondPlace.characterName}\n          thirdPlaceChar={thirdPlace.characterName}\n          logo1={firstPlace.logo}\n          logo2={secondPlace.logo}\n          logo3={thirdPlace.logo}\n          socketClose={wsClose}\n        />\n      );\n    } else {\n      return <Race raceProgress={raceProgress} array={ordersArr} />;\n    }\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}